---
common_stack:
  state: "{{ state | default('present')}}"
  region: "{{ region }}"
  disable_rollback: true
  template: "templates/Datashades-OpsWorks-CKAN-Instances.cfn.yml"
  template_parameters:
    OpsWorksStackID: "{{ Environment }}{{ titlecase_name }}OpsWorksStack"
    DataPusherLayerID: "{{ Environment }}{{ titlecase_name }}OpsWorksDataPusherLayer"
    SolrLayerID: "{{ Environment }}{{ titlecase_name }}OpsWorksSolrLayer"
    WebLayerID: "{{ Environment }}{{ titlecase_name }}OpsWorksWebLayer"
    AppSubnets: "{{ Environment }}CKANAppSubnet"
    EnableDataStore: "{{ enable_datastore | default('no') }}"
  tags:
    Environment: "{{ Environment }}"
    Service: "{{ titlecase_name }}"
    Division: "{{ Division }}"
    Owner: "{{ Owner }}"
    Version: "1.0"

cloudformation_stacks:
  - name: "{{ titlecase_name }}-PROD-OpsWorks-instances"
    template_parameters:
      Environment: PROD
      WebEC2Count: 2
    tags:
      PowerManaged: "No"

  - name: "{{ titlecase_name }}-STAGING-OpsWorks-instances"
    template_parameters:
      Environment: STAGING
      WebEC2Size: t3.small
      WebEC2Count: 2
    tags:
      PowerManaged: "No"

  - name: "{{ titlecase_name }}-TRAINING-OpsWorks-instances"
    template_parameters:
      Environment: TRAINING
      WebEC2Size: t3.small
    tags:
      PowerManaged: "Yes"

  - name: "{{ titlecase_name }}-DEV-OpsWorks-instances"
    template_parameters:
      Environment: DEV
      ServicesEC2Size: t3.micro
      WebEC2Size: t3.micro
    tags:
      PowerManaged: "Yes"
